<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urban Gardening Assistant</title>
    <link rel="stylesheet" href="clean-styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
        import { getStorage } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-storage.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyBxuUuIabTyxNP5I75nrwpzyBhpa9v1qYg",
            authDomain: "urban-garden-afb64.firebaseapp.com",
            projectId: "urban-garden-afb64",
            storageBucket: "urban-garden-afb64.firebasestorage.app",
            messagingSenderId: "551109183538",
            appId: "1:551109183538:web:e05fad7a5acf96b9b7142b"
        };
        
        const app = initializeApp(firebaseConfig);
        window.auth = getAuth(app);
        window.db = getFirestore(app);
        window.storage = getStorage(app);
        
        window.auth.onAuthStateChanged(async (user) => {
            if (!user) {
                window.location.href = 'login.html';
            } else {
                await loadUserProfile(user);
            }
        });
        
        async function loadUserProfile(user) {
            try {
                const { doc, getDoc } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js');
                const docSnap = await getDoc(doc(window.db, 'users', user.uid));
                
                let userData = null;
                let displayName = user.email.split('@')[0];
                
                if (docSnap.exists()) {
                    userData = docSnap.data();
                    displayName = userData.displayName || displayName;
                    
                    if (userData.photoURL) {
                        const profileImage = document.getElementById('profileImage');
                        const profilePlaceholder = document.getElementById('profilePlaceholder');
                        if (profileImage && profilePlaceholder) {
                            profileImage.src = userData.photoURL;
                            profileImage.style.display = 'block';
                            profilePlaceholder.style.display = 'none';
                        }
                    }
                }
                
                const profileName = document.getElementById('profileName');
                const profileEmail = document.getElementById('profileEmail');
                if (profileName) profileName.textContent = displayName;
                if (profileEmail) profileEmail.textContent = user.email;
                
                await loadDashboardStats(user);
                
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }
        
        async function loadDashboardStats(user) {
            try {
                const { doc, getDoc, collection, query, getDocs } = await import('https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js');
                
                const gardenDoc = await getDoc(doc(window.db, 'gardens', user.uid));
                const plantCount = gardenDoc.exists() ? (gardenDoc.data().plants || []).length : 0;
                
                const journalQuery = query(collection(window.db, 'journal', user.uid, 'entries'));
                const journalSnapshot = await getDocs(journalQuery);
                
                const plantCountEl = document.getElementById('plantCount');
                const taskCountEl = document.getElementById('taskCount');
                const journalCountEl = document.getElementById('journalCount');
                const pointsCountEl = document.getElementById('pointsCount');
                
                if (plantCountEl) plantCountEl.textContent = plantCount;
                if (taskCountEl) taskCountEl.textContent = plantCount * 4;
                if (journalCountEl) journalCountEl.textContent = journalSnapshot.size;
                if (pointsCountEl) pointsCountEl.textContent = (plantCount * 50) + (journalSnapshot.size * 25);
                
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
            }
        }
    </script>
</head>
<body>
    <div class="app-container">
        <!-- Desktop Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>üå± Urban Garden</h2>
            </div>
            
            <ul class="sidebar-nav">
                <li><a href="index.html" class="nav-link active"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="library.html" class="nav-link"><i class="fas fa-leaf"></i> Plant Library</a></li>
                <li><a href="garden.html" class="nav-link"><i class="fas fa-seedling"></i> My Garden</a></li>
                <li><a href="tasks.html" class="nav-link"><i class="fas fa-tasks"></i> Tasks</a></li>
                <li><a href="community.html" class="nav-link"><i class="fas fa-users"></i> Community</a></li>
                <li><a href="journal.html" class="nav-link"><i class="fas fa-book"></i> Journal</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <h1>Welcome to Your Garden! üåø</h1>
                <p>Your urban gardening journey starts here.</p>
            </div>
            
            <!-- Profile Card -->
            <div class="card">
                <div class="card-body">
                    <div class="profile-card">
                        <div class="profile-avatar" id="profileAvatar">
                            <span id="profilePlaceholder">üë§</span>
                            <img id="profileImage" style="display: none;">
                        </div>
                        <div class="profile-info">
                            <h3 id="profileName">Loading...</h3>
                            <p id="profileEmail">Loading...</p>
                            <div class="profile-status">üå± Garden Enthusiast</div>
                        </div>
                        <a href="profile.html" class="btn btn-secondary">
                            <i class="fas fa-edit"></i> Edit Profile
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card green">
                    <div class="stat-number" id="plantCount">0</div>
                    <div class="stat-label">Plants</div>
                </div>
                <div class="stat-card yellow">
                    <div class="stat-number" id="taskCount">0</div>
                    <div class="stat-label">Tasks</div>
                </div>
                <div class="stat-card purple">
                    <div class="stat-number" id="journalCount">0</div>
                    <div class="stat-label">Entries</div>
                </div>
                <div class="stat-card blue">
                    <div class="stat-number" id="pointsCount">0</div>
                    <div class="stat-label">Points</div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="action-buttons">
                <a href="library.html" class="btn btn-primary">
                    <i class="fas fa-leaf"></i> Browse Plants
                </a>
                <a href="garden.html" class="btn btn-primary">
                    <i class="fas fa-seedling"></i> My Garden
                </a>
                <a href="tasks.html" class="btn btn-primary">
                    <i class="fas fa-tasks"></i> View Tasks
                </a>
            </div>
            
            <!-- Seasonal Tips -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üçÇ Seasonal Tips</h2>
                </div>
                <div class="card-body">
                    <div class="tips-grid">
                        <div class="tip-card" style="background: linear-gradient(135deg, #fbbf24, #f59e0b);">
                            <div class="tip-icon">üçÇ</div>
                            <h3>Autumn Planting</h3>
                            <p>Perfect time to plant cool-season crops like lettuce, spinach, and radishes.</p>
                        </div>
                        
                        <div class="tip-card" style="background: linear-gradient(135deg, #10b981, #059669);">
                            <div class="tip-icon">üíß</div>
                            <h3>Watering Tips</h3>
                            <p>Reduce watering frequency as temperatures drop. Check soil moisture first.</p>
                        </div>
                        
                        <div class="tip-card" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                            <div class="tip-icon">üå±</div>
                            <h3>Indoor Growing</h3>
                            <p>Start herbs indoors for fresh cooking ingredients all winter long.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Mobile Navigation -->
        <nav class="mobile-nav">
            <div class="mobile-nav-grid">
                <a href="index.html" class="mobile-nav-item active">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="library.html" class="mobile-nav-item">
                    <i class="fas fa-leaf"></i>
                    <span>Library</span>
                </a>
                <a href="garden.html" class="mobile-nav-item">
                    <i class="fas fa-seedling"></i>
                    <span>Garden</span>
                </a>
                <a href="tasks.html" class="mobile-nav-item">
                    <i class="fas fa-tasks"></i>
                    <span>Tasks</span>
                </a>
                <a href="community.html" class="mobile-nav-item">
                    <i class="fas fa-users"></i>
                    <span>Community</span>
                </a>
                <a href="journal.html" class="mobile-nav-item">
                    <i class="fas fa-book"></i>
                    <span>Journal</span>
                </a>
            </div>
        </nav>

        <!-- FAB -->
        <button class="fab">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="script-simple.js"></script>
</body>
</html>